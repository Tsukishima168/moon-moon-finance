# 📊 點鈔機歷史記錄系統 - 使用指南

## 功能概述

這個系統可以**自動記錄每日點鈔機數據**，幫助您：
- ✅ 永久保存每日點鈔數據（便於日後查帳）
- ✅ 追蹤現金進出明細
- ✅ 檢查是否有遺漏或異常
- ✅ 手動確認後可刪除（防止數據堆積）
- ✅ 選擇上傳到 Google Sheet 存檔

---

## 🚀 完整流程

### **Step 1️⃣：進行日結**

1. 在 React App 點「日結」
2. Step 1：輸入開店金、確認系統應有金額
3. Step 2：點算現金（輸入各種鈔票數量）
   - ✅ 數據自動保存到 `localStorage`
   - ✅ 可隨時返回，數據不會丟失
4. Step 3：確認差異、輸入經手人名稱
5. 點「完成結帳」

**⚙️ 自動發生：**
- 日結數據上傳至 Firebase
- 點鈔機記錄保存到本地（`billsHistory`）
- 記錄標記為 `synced: false`（未上傳 Google Sheet）

---

### **Step 2️⃣：查看點鈔機歷史**

在 Dashboard 點「📊 查看點鈔機歷史」

**您會看到：**
- 所有歷史點鈔記錄（最新在上面）
- 每條記錄的詳細信息：
  - 日期和時間
  - 經手人
  - 實際點算金額
  - 明日保留金額
  - 差異金額
  - 各種鈔票的數量明細

**記錄狀態：**
- 🟡 **黃點**：未上傳 Google Sheet
- 🟢 **綠點**：已上傳 Google Sheet

---

### **Step 3️⃣：上傳到 Google Sheet（選擇性）**

點擊「📤 上傳 Google Sheet」按鈕

**執行流程：**
1. 點鈔機記錄上傳到 Firebase `bills_history` collection
2. Google Apps Script 自動同步到「🟣 點鈔機記錄」工作表
3. 前台記錄狀態更新為「已同步」✓

**何時上傳？**
- ✅ 確認點鈔無誤後立即上傳（建議）
- ✅ 或在月底統一上傳
- ✅ 或根本不上傳（只在本地保存）

---

### **Step 4️⃣：刪除已確認的記錄（可選）**

點擊「🗑️ 刪除」按鈕

**刪除前檢查清單：**
- ✅ 已確認點鈔正確
- ✅ （建議）已上傳到 Google Sheet
- ✅ 已存檔備份（如需要）

**刪除流程：**
1. 系統詢問確認
2. 記錄從本地 `localStorage` 刪除
3. 無法復原，請務必謹慎

---

## 📋 Google Sheet 數據結構

### 「🟣 點鈔機記錄」工作表

| 欄位 | 說明 | 例子 |
|------|------|------|
| 日期 | 點鈔日期 | 2026-01-03 |
| 時間 | 點鈔時間 | 22:35:15 |
| 經手人 | 負責員工 | 小王 |
| 實際點算 | 總現金 | 45300 |
| 明日保留 | 開店金 | 5110 |
| 差異 | 實際 - 系統應有 | +500 |
| 1000元 | 千元鈔數量 | 25 |
| 500元 | 五百元鈔數量 | 12 |
| 100元 | 百元鈔數量 | 3 |
| ... | ... | ... |
| 上傳時間 | 同步時間 | 2026-01-04 08:30:00 |

**這樣您可以：**
- 🔍 隨時查看歷史點鈔記錄
- 📊 對帳時核對現金進出
- 📈 分析員工績效（點鈔精準度）
- 🛡️ 防止舞弊（完整的審計追蹤）

---

## 💡 使用場景

### 場景 1：日常查帳
**情況**：想查 1 月 15 日的點鈔數據

**做法**：
1. 打開 React App → 「📊 查看點鈔機歷史」
2. 找到「2026-01-15」的記錄
3. 點擊展開，查看詳細的鈔票組成

### 場景 2：月結對帳
**情況**：月底要和會計對帳

**做法**：
1. 打開 Google Sheet → 「🟣 點鈔機記錄」
2. 可以看到整個月的點鈔記錄
3. 計算總差異、追蹤異常

### 場景 3：員工績效分析
**情況**：想知道某員工點鈔的準確性

**做法**：
1. 篩選「經手人」欄位
2. 分析該員工的「差異」數據
3. 正差異較多 → 可能有漏點
4. 負差異較多 → 要檢查是否少算

---

## ⚙️ 技術細節

### 數據儲存位置

```
本地 localStorage
├─ billsBackup       ← 當前點鈔機狀態（臨時）
└─ billsHistory      ← 歷史點鈔記錄（永久）
    └─ [{
         date: "2026-01-03",
         time: "22:35:15",
         bills: { 1000: 25, 500: 12, ... },
         actualCounted: 45300,
         closingFloat: 5110,
         variance: 500,
         staffName: "小王",
         synced: false,
         syncTime: null
       }, ...]

Firebase
├─ daily_closings    ← 日結紀錄
└─ bills_history     ← 上傳的點鈔機記錄
    └─ {
         date: "2026-01-03",
         time: "22:35:15",
         bills_json: "{"1000": 25, "500": 12, ...}",
         actual_counted: 45300,
         ...
       }

Google Sheet
└─ 🟣 點鈔機記錄
   └─ [日期, 時間, 經手人, 實際點算, 明日保留, 差異, ...]
```

---

## 🛡️ 最佳實踐

### ✅ 建議做法

1. **每日結帳後立即上傳**
   ```
   點算完成 → 確認無誤 → 上傳 Google Sheet → 刪除本地
   ```

2. **定期檢查 Google Sheet**
   ```
   每週：查看最近 7 天是否有異常差異
   每月：月底對帳，確認總現金
   ```

3. **保留異常記錄**
   ```
   若差異 ≠ 0，先調查原因再刪除
   防止隱藏問題
   ```

4. **建立備份**
   ```
   Google Sheet = 雲端備份
   本地 localStorage = 快速查詢
   雙層保護，數據不丟失
   ```

---

## ❌ 常見錯誤

### 錯誤 1：沒有上傳就刪除
❌ **後果**：只有本地記錄，手機換機就沒了

✅ **正確做法**：
1. 確認後上傳到 Google Sheet
2. 看到「✓ 已同步」後再刪除

### 錯誤 2：忽視差異
❌ **後果**：無法發現現金問題、防不了舞弊

✅ **正確做法**：
1. 差異 ≠ 0 時立即調查
2. 記錄原因（員工備註）
3. 月底總結分析

### 錯誤 3：長期不清理
❌ **後果**：localStorage 堆滿數據，手機變慢

✅ **正確做法**：
1. 每週清理一次
2. 已上傳且確認的記錄刪除
3. 保留 3-6 個月的備份在 Google Sheet

---

## 🔧 故障排除

### Q：為什麼上傳後沒看到新欄目？
A：
1. Google Apps Script 需要時間同步（1-5分鐘）
2. 手動點「🔄 立即同步今日帳務」加速
3. 若還是沒有，檢查「📊 查看同步日誌」

### Q：刪除後能否復原？
A：
- **本地數據**：❌ 無法復原（已從 localStorage 清除）
- **Google Sheet**：✅ 可以（在「🟣 點鈔機記錄」查看）

### Q：能否修改已上傳的記錄？
A：
- **React App**：❌ 刪除後無法修改
- **Google Sheet**：✅ 可以手動編輯（但不建議）

---

## 📈 下次更新計畫

- [ ] 批量上傳功能（一次上傳多條記錄）
- [ ] 差異分析報表（自動統計、預警）
- [ ] 員工點鈔排名（激勵機制）
- [ ] 雲端同步（無需手動上傳）
- [ ] 導出 Excel（方便會計使用）

---

## 📞 支援

**有問題？**
1. 檢查「📊 查看同步日誌」看是否有錯誤信息
2. 點「🔍 檢查 Firebase 連線狀態」驗證連線
3. 查看本指南的「故障排除」部分

**安心使用！** 🛡️✨
